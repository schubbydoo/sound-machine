<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Worksheet</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        h1 { text-align: center; font-size: 1.5em; margin: 10px 0; }
        .instructions {
            margin: 10px 0;
            padding: 10px;
            background: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 0.9em;
        }
        table { width: 100%; border-collapse: collapse; margin-top: 10px; font-size: 0.9em; }
        th, td { border: 1px solid #ccc; padding: 4px 8px; text-align: left; }
        th { background: #eee; }
        .answer-col { width: 60%; }
        .btn-col { width: 50px; text-align: center; }
        .hint-col { width: 30%; color: #666; font-style: italic; }
        
        .page-break { page-break-after: always; }
        .worksheet-container { margin-bottom: 40px; }

        /* Grid Layout Styles */
        .grid-view {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }
        .grid-view .worksheet-container {
            margin-bottom: 20px;
            break-inside: avoid;
            border: 1px solid #eee;
            padding: 10px;
        }
        .grid-view .page-break {
            page-break-after: auto;
        }

        /* Button 4x4 Grid Styles */
        .button-grid-container {
            display: grid;
            grid-template-columns: repeat(4, 1fr);
            gap: 10px;
            margin-top: 15px;
        }
        .button-cell {
            border: 1px solid #999;
            border-radius: 8px;
            padding: 10px;
            min-height: 100px;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: flex-start;
            text-align: center;
            background: #fdfdfd;
        }
        .button-number {
            font-size: 1.4em;
            font-weight: bold;
            color: #333;
            margin-bottom: 5px;
            background: #eee;
            width: 30px;
            height: 30px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        .button-content {
            font-size: 0.9em;
            word-break: break-word;
            margin-bottom: 10px;
            min-height: 20px;
        }
        .button-answer-line {
            width: 100%;
            border-bottom: 1px solid #333;
            margin-top: auto;
            min-height: 20px;
        }

        @media print {
            .no-print { display: none; }
            .instructions { border: 1px solid #000; background: none; }
            th { background: none; border-bottom: 2px solid #000; }
            .worksheet-container { margin-bottom: 0; }
            .grid-view { display: grid; }
        }
        
        .controls {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
            margin-bottom: 20px;
        }
    </style>
</head>
<body>
    <div class="no-print">
        <div class="controls">
            <div style="margin-bottom: 10px;">
                <button onclick="window.print()" style="font-size: 1.1em; padding: 5px 15px; cursor: pointer;">Print Worksheet</button>
                <button onclick="window.close()" style="font-size: 1.1em; padding: 5px 15px; cursor: pointer;">Close</button>
            </div>
            
            <!-- View Mode Selection -->
            <div style="margin-bottom: 15px;">
                <label style="margin-right: 20px;">
                    <input type="radio" name="viewMode" value="list" onchange="toggleViewMode()" checked> List View
                </label>
                <label>
                    <input type="radio" name="viewMode" value="buttonGrid" onchange="toggleViewMode()"> 4x4 Button Grid
                </label>
            </div>

            <div id="listViewControls">
                <label class="checkbox-group" style="font-weight: bold; color: #0066cc; display: block; margin-bottom: 10px;">
                    <input type="checkbox" id="cb-grid" onchange="toggleGrid()"> Compact List Grid (2 per page)
                </label>
                 <label style="cursor: pointer;">
                    <input type="checkbox" id="cb-hint" checked onchange="toggleHint()"> Include Hint / Category
                </label>
            </div>
            
            <!-- Button Grid Controls -->
            <div id="buttonGridControls" style="display: none;">
                <strong>Grid Content:</strong>
                <select id="gridContentSelect" onchange="updateGridContent()">
                    <option value="hint">Hint / Category</option>
                    <option value="none">None (Blank)</option>
                </select>
            </div>
        </div>
    </div>

    <div id="profiles-container">
        {% for item in items %}
        <div class="worksheet-container {% if not loop.last %}page-break{% endif %}">
            <h1>{{ item.profile.name }} {% if item.profile.channel_number %}(Track {{ item.profile.channel_number }}){% endif %}</h1>
            
            {% if item.profile.instructions %}
            <div class="instructions">
                <strong>Instructions:</strong> {{ item.profile.instructions }}
            </div>
            {% endif %}
            
            <!-- List View Table -->
            <table class="list-view-el">
                <thead>
                    <tr>
                        <th class="btn-col">Button</th>
                        <th class="hint-col">Hint / Category</th>
                        <th class="answer-col">Your Answer</th>
                    </tr>
                </thead>
                <tbody>
                    {% for r in item.rows %}
                    <tr>
                        <td class="btn-col"><strong>{{ r.button_id }}</strong></td>
                        <td class="hint-col">{{ r.hint or '' }}</td>
                        <td class="answer-col"></td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
            
            <!-- 4x4 Button Grid View -->
            <div class="button-grid-container button-grid-view-el" style="display: none;">
                {% for i in range(1, 17) %}
                {% set row = item.map.get(i) %}
                <div class="button-cell">
                    <div class="button-number">{{ i }}</div>
                    <div class="button-content content-hint">
                        {{ row.hint if row else '' }}
                    </div>
                    <div class="button-content content-none" style="display:none;"></div>
                    <div class="button-answer-line"></div>
                </div>
                {% endfor %}
            </div>
        </div>
        {% endfor %}
    </div>

    <script>
        function toggleViewMode() {
            const mode = document.querySelector('input[name="viewMode"]:checked').value;
            const isList = mode === 'list';
            
            document.getElementById('listViewControls').style.display = isList ? 'block' : 'none';
            document.getElementById('buttonGridControls').style.display = isList ? 'none' : 'block';
            
            document.querySelectorAll('.list-view-el').forEach(el => el.style.display = isList ? '' : 'none');
            document.querySelectorAll('.button-grid-view-el').forEach(el => el.style.display = isList ? 'none' : 'grid');
            
            localStorage.setItem('print_worksheet_view_mode', mode);
        }

        function updateGridContent() {
            const content = document.getElementById('gridContentSelect').value;
            // Hide all content divs
            document.querySelectorAll('.button-content').forEach(el => el.style.display = 'none');
            // Show selected
            document.querySelectorAll('.content-' + content).forEach(el => el.style.display = 'block');
            
            localStorage.setItem('print_worksheet_grid_content', content);
        }

        function toggleGrid() {
            const isGrid = document.getElementById('cb-grid').checked;
            const container = document.getElementById('profiles-container');
            if (isGrid) {
                container.classList.add('grid-view');
            } else {
                container.classList.remove('grid-view');
            }
            localStorage.setItem('print_worksheet_grid', isGrid);
        }

        function toggleHint() {
            const show = document.getElementById('cb-hint').checked;
            const cells = document.querySelectorAll('.hint-col');
            cells.forEach(c => c.style.display = show ? '' : 'none');
            
            // Adjust widths if hint is hidden to give more space to answer
            const answers = document.querySelectorAll('.answer-col');
            answers.forEach(c => c.style.width = show ? '60%' : '90%');
            
            localStorage.setItem('print_worksheet_hint', show);
        }

        // Load preference
        window.onload = function() {
            // Load View Mode
            const viewMode = localStorage.getItem('print_worksheet_view_mode');
            if (viewMode) {
                const radio = document.querySelector(`input[name="viewMode"][value="${viewMode}"]`);
                if (radio) {
                    radio.checked = true;
                    toggleViewMode();
                }
            }
            
            // Load Grid Content
            const gridContent = localStorage.getItem('print_worksheet_grid_content');
            if (gridContent) {
                document.getElementById('gridContentSelect').value = gridContent;
                updateGridContent();
            }

            // Load Grid Preference
            const gridStored = localStorage.getItem('print_worksheet_grid');
            if (gridStored !== null) {
                const isGrid = gridStored === 'true';
                document.getElementById('cb-grid').checked = isGrid;
                if (isGrid) {
                    document.getElementById('profiles-container').classList.add('grid-view');
                }
            }

            const stored = localStorage.getItem('print_worksheet_hint');
            if (stored !== null) {
                const shouldShow = stored === 'true';
                document.getElementById('cb-hint').checked = shouldShow;
                
                // Apply initial state
                const cells = document.querySelectorAll('.hint-col');
                cells.forEach(cell => cell.style.display = shouldShow ? '' : 'none');
                
                const answers = document.querySelectorAll('.answer-col');
                answers.forEach(c => c.style.width = shouldShow ? '60%' : '90%');
            }
        }
    </script>
</body>
</html>

