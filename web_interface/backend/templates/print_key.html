<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Answer Key - {{ profile.name }}</title>
    <style>
        body { font-family: sans-serif; padding: 20px; }
        h1 { text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background: #eee; }
        @media print {
            .no-print { display: none; }
        }
        .controls {
            background: #f5f5f5;
            padding: 15px;
            border-radius: 5px;
            border: 1px solid #ddd;
        }
        .checkbox-group {
            display: inline-block;
            margin-right: 15px;
        }
    </style>
</head>
<body>
    <div class="no-print" style="margin-bottom: 20px;">
        <div class="controls">
            <div style="margin-bottom: 10px;">
                <button onclick="window.print()" style="font-size: 1.1em; padding: 5px 15px;">Print</button>
                <button onclick="window.close()" style="font-size: 1.1em; padding: 5px 15px;">Close</button>
            </div>
            <div>
                <strong>Columns:</strong>
                <label class="checkbox-group"><input type="checkbox" checked onchange="toggle('channel')" id="cb-channel"> Track</label>
                <label class="checkbox-group"><input type="checkbox" checked onchange="toggle('btn')" id="cb-btn"> Button #</label>
                <label class="checkbox-group"><input type="checkbox" checked onchange="toggle('desc')" id="cb-desc"> Description</label>
                <label class="checkbox-group"><input type="checkbox" checked onchange="toggle('cat')" id="cb-cat"> Category</label>
                <label class="checkbox-group"><input type="checkbox" checked onchange="toggle('hint')" id="cb-hint"> Hint</label>
                <label class="checkbox-group"><input type="checkbox" checked onchange="toggle('file')" id="cb-file"> Filename</label>
            </div>
        </div>
    </div>

    <h1>Answer Key: {{ profile.name }}</h1>
    {% if profile.instructions %}
    <div style="margin-bottom: 20px; font-style: italic; background: #f9f9f9; padding: 10px; border-left: 4px solid #ccc;">
        <strong>Instructions:</strong> {{ profile.instructions }}
    </div>
    {% endif %}
    
    <table id="keyTable">
        <thead>
            <tr>
                <th class="col-channel">Track</th>
                <th class="col-btn" width="50">#</th>
                <th class="col-desc">Description</th>
                <th class="col-cat">Category</th>
                <th class="col-hint">Hint</th>
                <th class="col-file">Filename</th>
            </tr>
        </thead>
        <tbody>
            {% for r in rows %}
            <tr>
                <td class="col-channel">{{ profile.channel_number or '-' }}</td>
                <td class="col-btn">{{ r.button_id }}</td>
                <td class="col-desc">{{ r.description or '' }}</td>
                <td class="col-cat">{{ r.category or '' }}</td>
                <td class="col-hint">{{ r.hint or '' }}</td>
                <td class="col-file">{{ r.filename }}</td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <script>
        function toggle(colName) {
            const show = document.getElementById('cb-' + colName).checked;
            const cells = document.querySelectorAll('.col-' + colName);
            cells.forEach(c => c.style.display = show ? '' : 'none');
            
            // Save preference
            localStorage.setItem('print_key_col_' + colName, show);
        }

        // Load preferences
        window.onload = function() {
            const cols = ['channel', 'btn', 'desc', 'cat', 'hint', 'file'];
            cols.forEach(c => {
                const stored = localStorage.getItem('print_key_col_' + c);
                if (stored !== null) {
                    const shouldShow = stored === 'true';
                    document.getElementById('cb-' + c).checked = shouldShow;
                    // Apply initial state
                    const cells = document.querySelectorAll('.col-' + c);
                    cells.forEach(cell => cell.style.display = shouldShow ? '' : 'none');
                }
            });
        }
    </script>
</body>
</html>
